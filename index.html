<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Times & Division Trainer</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
  <style>
    body {
      background: linear-gradient(135deg, #ffecd2, #fcb69f);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }
    .problem-box {
      font-size: 2rem;
      text-align: center;
      margin-top: 2rem;
    }
    .answer-input {
      font-size: 2rem;
      text-align: center;
      width: 120px;
    }
    .streak-box, .best-box {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      margin: 0 10px;
      color: #fff;
      background: rgba(0,0,0,0.2);
      border-radius: 12px;
      padding: 0.5rem 1rem;
    }
    .icon {
      margin-right: 0.3rem;
    }
    .dots {
      display: flex;
      justify-content: center;
      margin: 1rem 0;
    }
    .dot {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      margin: 0 5px;
      background: lightgray;
    }
    .dot.correct { background: #48c774; }
    .dot.wrong { background: #f14668; }
    .keyboard {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      max-width: 300px;
      margin: 1rem auto;
    }
    .key {
      background: #fff;
      border-radius: 10px;
      padding: 1rem;
      font-size: 1.5rem;
      text-align: center;
      box-shadow: 0 4px 6px rgba(0,0,0,0.2);
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .key:active, .key.glow {
      background: #ffe08a;
      box-shadow: 0 0 20px #ffdd57;
      transform: scale(1.1);
    }
    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem;
    }
  </style>
</head>
<body>
  <div class="top-bar">
    <div class="streak-box">
      <span class="icon">üî•</span><span id="streak">0</span>
    </div>
    <h1 class="title has-text-centered">Math Trainer</h1>
    <div class="best-box">
      <span class="icon">üèÜ</span><span id="best">0</span>
    </div>
    <button id="muteBtn" class="button is-small">üîä</button>
  </div>

  <div class="problem-box">
    <span id="problem"></span>
    <input id="answer" class="input answer-input" type="number" autocomplete="off">
  </div>

  <div class="keyboard">
    <div class="key">1</div>
    <div class="key">2</div>
    <div class="key">3</div>
    <div class="key">4</div>
    <div class="key">5</div>
    <div class="key">6</div>
    <div class="key">7</div>
    <div class="key">8</div>
    <div class="key">9</div>
    <div class="key">0</div>
    <div class="key">‚Üê</div>
    <div class="key">‚èé</div>
  </div>

  <div class="dots" id="dots"></div>

  <script>
    const problemEl = document.getElementById('problem');
    const answerEl = document.getElementById('answer');
    const streakEl = document.getElementById('streak');
    const bestEl = document.getElementById('best');
    const dotsEl = document.getElementById('dots');
    const muteBtn = document.getElementById('muteBtn');

    let streak = 0;
    let best = parseInt(localStorage.getItem('bestScore')) || 0;
    bestEl.textContent = best;
    let history = [];
    let currentAnswer;
    let muted = false;

    const correctSound = new Audio("https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg");
    const wrongSound = new Audio("https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg");

    function playSound(sound) {
      if (!muted) sound.play();
    }

    muteBtn.addEventListener('click', () => {
      muted = !muted;
      muteBtn.textContent = muted ? "üîá" : "üîä";
    });

    function newProblem() {
      let isDivision = Math.random() < 0.5;
      let a = Math.floor(Math.random() * 10) + 1;
      let b = Math.floor(Math.random() * 10) + 1;

      if (isDivision) {
        currentAnswer = a;
        problemEl.textContent = `${a*b} √∑ ${b} = __`;
      } else {
        currentAnswer = a*b;
        problemEl.textContent = `${a} √ó ${b} = __`;
      }
      answerEl.value = "";
      answerEl.focus();
    }

    function updateDots(correct) {
      history.push(correct);
      if (history.length > 5) history.shift();
      dotsEl.innerHTML = "";
      history.forEach(h => {
        const dot = document.createElement('div');
        dot.classList.add('dot');
        if (h === true) dot.classList.add('correct');
        if (h === false) dot.classList.add('wrong');
        dotsEl.appendChild(dot);
      });
    }

    function checkAnswer() {
      const val = parseInt(answerEl.value);
      if (isNaN(val)) return;
      if (val === currentAnswer) {
        playSound(correctSound);
        streak++;
        if (streak > best) {
          best = streak;
          localStorage.setItem('bestScore', best);
          bestEl.textContent = best;
        }
        updateDots(true);
      } else {
        playSound(wrongSound);
        streak = 0;
        updateDots(false);
      }
      streakEl.textContent = streak;
      newProblem();
    }

    answerEl.addEventListener('keydown', (e) => {
      if (e.key === "Enter") checkAnswer();
    });

    document.querySelectorAll('.key').forEach(key => {
      key.addEventListener('click', () => {
        let val = key.textContent;
        key.classList.add("glow");
        setTimeout(() => key.classList.remove("glow"), 400);
        if (val === "‚èé") {
          checkAnswer();
        } else if (val === "‚Üê") {
          answerEl.value = answerEl.value.slice(0, -1);
        } else {
          answerEl.value += val;
        }
        answerEl.focus();
      });
    });

    newProblem();
  </script>
</body>
</html>
